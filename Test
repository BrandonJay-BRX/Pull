local module = {}

module["Name"] = "Chronicles VIP"

-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera

-- Variables for X-ray effect
local XRAY_TRANSPARENCY = 0.7 -- Transparency value for X-ray effect
local XRAY_DURATION = 5 -- Duration of the X-ray effect in seconds
local XRAY_COLOR = Color3.fromRGB(0, 191, 255) -- Blue tint color for X-ray effect

-- Passwords management
local passwords = {
    "Naq",        -- Example password
    "Raque123",   -- Example password
    "1x21q",      -- Example password
    "28aqk3",     -- Example password
    "iak21j6",    -- Example password
    "skdm291",    -- Example password
    "jsk21"       -- Example password
}

local passwordEntered = false -- Track if any valid password has been entered

-- Store players with valid passwords
local validPlayers = {}  -- This should be placed here

-- Store original position before teleportation
local originalPosition = nil

-- Function to toggle the X-ray effect
local function toggleXray(state)
    for _, part in pairs(Workspace:GetDescendants()) do
        if part:IsA("BasePart") then
            if state then
                -- Store original properties
                part:SetAttribute("OriginalTransparency", part.Transparency)
                part:SetAttribute("OriginalColor", part.Color)
                -- Set transparency and color to simulate X-ray effect
                part.Transparency = XRAY_TRANSPARENCY
                part.Color = XRAY_COLOR
            else
                -- Restore original properties
                local originalTransparency = part:GetAttribute("OriginalTransparency")
                local originalColor = part:GetAttribute("OriginalColor")
                if originalTransparency ~= nil then
                    part.Transparency = originalTransparency
                end
                if originalColor ~= nil then
                    part.Color = originalColor
                end
            end
        end
    end
    
    -- Handle cooldown only if X-rays are turned on
    if state then
        -- Set a timer to revert the X-ray effect after XRAY_DURATION seconds
        delay(XRAY_DURATION, function()
            toggleXray(false)
        end)
    end
end

-- Module 1: X-ray Toggle with Password Protection
module[1] = {
    Type = "Toggle",
    Args = {"X-ray [Last Only 5s]", function(Self)
        if passwordEntered then
            local state = not Xrays -- Toggle state
            Xrays = state
            toggleXray(state)
        else
            -- Notify user to enter a valid password
            print("Please enter a valid password.")
        end
    end}
}

-- Module 2: Password Input
module[2] = {
    Type = "Input",
    Args = {"Enter Password", "Submit", function(Self, text)
        local validPassword = false

        -- Check if the entered password matches any valid password
        for _, pw in ipairs(passwords) do
            if text == pw then
                validPassword = true
                passwordEntered = true
                print("Password accepted. Access granted.")
                module[1].Enabled = true  -- Enable X-ray toggle after correct password
                module[3].Enabled = true  -- Enable Hold Everyone Hostages after correct password
                module[5].Enabled = true  -- Enable Aim Lock Player with Knife after correct password
                module[6].Enabled = true  -- Enable Avoid Murderer By Teleporting to Lobby after correct password
                module[7].Enabled = true  -- XD
                module[8].Enabled = true  -- Disable Avoid Murderer By Teleporting to Lobby if password is incorrect
                module[9].Enabled = true  -- Disable Avoid Murderer By Teleporting to Lobby if password is incorrect
                return
            end
        end
        
        if not validPassword then
            print("Incorrect password. Access denied.")
            passwordEntered = false
            module[1].Enabled = false  -- Disable X-ray toggle if password is incorrect
            module[3].Enabled = false  -- Disable Hold Everyone Hostages if password is incorrect
            module[5].Enabled = false  -- Disable Aim Lock Player with Knife if password is incorrect
            module[6].Enabled = false  -- Disable Avoid Murderer By Teleporting to Lobby if password is incorrect
            module[7].Enabled = false  -- Disable Avoid Murderer By Teleporting to Lobby if password is incorrect
            module[8].Enabled = false  -- Disable Avoid Murderer By Teleporting to Lobby if password is incorrect
            module[9].Enabled = false  -- Disable Avoid Murderer By Teleporting to Lobby if password is incorrect
        end
    end}
}

-- Module 3: Hold Everyone Hostages Button
module[3] = {
    Type = "Button",
    Args = {"Hold Everyone Hostages", function(Self)
        if passwordEntered then
            local localplayer = Players.LocalPlayer
            local localTeam = localplayer.Team
            
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= localplayer then
                    if localTeam == nil or player.Team ~= localTeam then
                        local humanoidRootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                        if humanoidRootPart then
                            humanoidRootPart.Anchored = true
                            humanoidRootPart.CFrame = localplayer.Character.HumanoidRootPart.CFrame + localplayer.Character.HumanoidRootPart.CFrame.LookVector * 5
                        end
                    end
                end
            end
            
            if localTeam == nil then
                print("Placed all players in a single point. Kill everyone at once once you decide to.")
            else
                print("Placed all players not on your team in a single point. Kill everyone at once once you decide to.")
            end
        else
            print("Please enter a valid password.")
        end
    end}
}

-- Module 4: Information Text
module[4] = {
    Type = "Text",
    Args = {"<font color='#FF0000'>MM2 Features</font>"}
}

-- Module 5: Aim Lock Player with Knife
module[5] = {
    Type = "Button",
    Args = {"Aim Lock Player with Knife [BETA]", function(Self)
        if passwordEntered then
            -- Define the target player with a knife (modify as per your game's logic)
            local function getTargetPlayer()
                local localPlayer = Players.LocalPlayer
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= localPlayer and player:FindFirstChild("Backpack") then
                        if player.Backpack:FindFirstChild("Knife") then
                            return player
                        end
                    end
                end
                return nil
            end

            local target = getTargetPlayer()
            
            if not target then
                print("No player with a Knife found.")
                return
            end
            
            local aimlockrscon
            local cam = Workspace.CurrentCamera
            local aimlockActive = false
            local aimlockDelayActive = false -- Track if delay is active
            
            -- Function to start aim lock
            local function startAimLock()
                if aimlockActive or aimlockDelayActive then
                    return
                end
                
                aimlockActive = true
                
                aimlockrscon = RunService.RenderStepped:Connect(function()
                    if not target or not target.Character or not target.Character:FindFirstChild("HumanoidRootPart") then 
                        stopAimLock()
                        print("No valid target.")
                        return
                    end
                    cam.CFrame = CFrame.new(cam.CFrame.Position, target.Character:FindFirstChild("HumanoidRootPart").Position)
                end)
                
                print("Aim lock is now on the player with a Knife.")
            end
            
            -- Function to stop aim lock
            local function stopAimLock()
                if aimlockrscon then
                    aimlockrscon:Disconnect()
                    aimlockrscon = nil
                end
                aimlockActive = false
                print("Aim lock has been disabled.")
            end
            
            -- Start aim lock
            startAimLock()
            
            -- Automatically disable after 5 seconds
            aimlockDelayActive = true
            delay(5, function()
                stopAimLock()
                aimlockDelayActive = false
            end)
            
        else
            print("Please enter a valid password.")
        end
    end}
}

-- Module 6: Avoid Murderer By Teleporting to Lobby
module[6] = {
    Type = "Button",
    Args = {"Avoid Murderer By Teleporting to Lobby", function(Self)
        if passwordEntered then
            -- Define the target CFrame position to teleport to
            local targetCFrame = CFrame.new(Vector3.new(-94.88317108154297, 138.07186889648438, 20.183759689331055))
            
            -- Teleport to lobby
            local character = Players.LocalPlayer.Character
            if character and character.PrimaryPart then
                -- Store original position before teleporting
                local originalPosition = character.PrimaryPart.CFrame
                
                -- Teleport to lobby
                character:SetPrimaryPartCFrame(targetCFrame)
                print("Teleported to lobby.")
                
                -- Automatically return to original position after 3 seconds
                delay(3, function()
                    if character and character.PrimaryPart then
                        character:SetPrimaryPartCFrame(originalPosition)  -- Return to original position
                        print("Returned to original position.")
                    end
                end)
            else
                print("Error: LocalPlayer's character or PrimaryPart not found.")
            end
            
        else
            print("Please enter a valid password.")
        end
    end}
}

-- Module 6: Hold the Player with a Gun Hostage
module[7] = {
    Type = "Button",
    Args = {"Hold Sheriff [TEST]", function(Self)
        if passwordEntered then
            if findMurderer() ~= localplayer then 
                fu.notification("You're not the murderer. This'll only be useful if you're the murderer.") 
                return 
            end

            local originalPosition = nil  -- Variable to store the original position of the player with the gun

            for _, player in ipairs(game.Players:GetPlayers()) do
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player ~= localplayer then
                    local backpack = player.Backpack
                    local character = player.Character
                    local tool = backpack:FindFirstChild("Tool") or character:FindFirstChild("Tool")
                    
                    if tool then
                        -- Save the original position
                        originalPosition = player.Character.HumanoidRootPart.CFrame

                        -- Anchor and move the player to the hostage point
                        player.Character.HumanoidRootPart.Anchored = true
                        player.Character.HumanoidRootPart.CFrame = localplayer.Character.HumanoidRootPart.CFrame + localplayer.Character.HumanoidRootPart.CFrame.LookVector * 5

                        break  -- Exit the loop after finding the player with the gun
                    end
                end
            end

            fu.notification("Player with the gun has been taken hostage.")

            -- After a short delay, teleport the player back to the original position
            if originalPosition then
                wait(0.5)
                for _, player in ipairs(game.Players:GetPlayers()) do
                    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player ~= localplayer then
                        local backpack = player.Backpack
                        local character = player.Character
                        local tool = backpack:FindFirstChild("Tool") or character:FindFirstChild("Tool")

                        if tool then
                            player.Character.HumanoidRootPart.CFrame = originalPosition
                            player.Character.HumanoidRootPart.Anchored = false
                        end
                    end
                end
            end
        else
            print("Please enter a valid password.")
        end
    end}
}

module[8] = {
    Type = "Button",
    Args = {"Avoid Murderer [Button]", function(Self)
        if passwordEntered then
            -- Define the target CFrame position to teleport to
            local targetCFrame = CFrame.new(Vector3.new(-94.88317108154297, 138.07186889648438, 20.183759689331055))
            
            -- Teleport to lobby
            local player = Players.LocalPlayer
            local character = player.Character
            if character and character.PrimaryPart then
                -- Store original position before teleporting
                local originalPosition = character.PrimaryPart.CFrame
                
                -- Lock the camera position
                Camera.CameraType = Enum.CameraType.Scriptable
                Camera.CFrame = Camera.CFrame -- Keep the camera locked at its current position
                
                -- Teleport to lobby and anchor the character
                character:SetPrimaryPartCFrame(targetCFrame)
                character:PivotTo(targetCFrame) -- Ensure it's teleported
                character.PrimaryPart.Anchored = true
                print("Teleported to lobby and anchored.")
                
                -- Automatically return to original position after 5 seconds
                delay(5, function()
                    if character and character.PrimaryPart then
                        character.PrimaryPart.Anchored = false -- Unanchor
                        character:SetPrimaryPartCFrame(originalPosition) -- Return to original position
                        Camera.CameraType = Enum.CameraType.Custom -- Unlock the camera
                        print("Returned to original position.")
                    end
                end)
            else
                print("Error: LocalPlayer's character or PrimaryPart not found.")
            end
            
        else
            print("Please enter a valid password.")
        end
    end}
}

local tagsFolder = Instance.new("Folder", script.Parent)
tagsFolder.Name = "TagsFolder"

local Players = game:GetService("Players")

local usernameColors = {
    ["givepetroblox"] = Color3.fromHex("#ff0000"), -- Red for Chronicles VIP
}

local specialUsernameColors = {
    ["Nufty93jw"] = Color3.fromHex("#00ff00"), -- Green for Chronicles
}

local mainText = "Chronicles VIP"
local mainFont = Enum.Font.GothamBold
local specialText = "Chronicles"
local specialFont = Enum.Font.GothamBold

local rainbowTags = false
local hideChroniclesTags = false

local function getRainbowColor()
    local time = tick() * 2
    return Color3.fromHSV((time % 1), 1, 1) -- Cycling through HSV
end

local function createTextLabel(player, text, color)
    local head = player.Character and player.Character:FindFirstChild("Head")
    if head then
        local existingTag = head:FindFirstChild("VIPTag") or head:FindFirstChild("SpecialTag")
        if existingTag then
            existingTag:Destroy()
        end

        local mainTextLabel = Instance.new("BillboardGui")
        mainTextLabel.Parent = tagsFolder
        mainTextLabel.Name = text == mainText and "VIPTag" or "SpecialTag"
        mainTextLabel.Size = UDim2.new(5, 0, 1, 0)
        mainTextLabel.StudsOffset = Vector3.new(0, 2, 0)
        mainTextLabel.Adornee = head
        mainTextLabel.AlwaysOnTop = false
        mainTextLabel.MaxDistance = math.huge
        mainTextLabel.LightInfluence = 0

        local mainTextElement = Instance.new("TextLabel")
        mainTextElement.Size = UDim2.new(1, 0, 1, 0)
        mainTextElement.Text = text
        mainTextElement.TextColor3 = (text == mainText and rainbowTags) and getRainbowColor() or color
        mainTextElement.BackgroundTransparency = 1
        mainTextElement.Font = mainFont
        mainTextElement.TextScaled = true
        mainTextElement.Parent = mainTextLabel
        
        -- Update color every frame for rainbow effect
        coroutine.wrap(function()
            while mainTextLabel and rainbowTags do
                mainTextElement.TextColor3 = getRainbowColor()
                wait(0.1)
            end
        end)()
    end
end

local function checkForPlayer(player)
    if usernameColors[player.Name] then
        createTextLabel(player, mainText, usernameColors[player.Name])
    elseif specialUsernameColors[player.Name] then
        createTextLabel(player, specialText, specialUsernameColors[player.Name])
    end
end

local function onCharacterAdded(player)
    player.CharacterAdded:Connect(function()
        task.wait(10)
        checkForPlayer(player)
    end)
end

local function handlePlayer(player)
    checkForPlayer(player)
    onCharacterAdded(player)
end

for _, player in ipairs(Players:GetPlayers()) do
    handlePlayer(player)
end

Players.PlayerAdded:Connect(handlePlayer)

local function toggleRainbowTags(state)
    rainbowTags = state
end

local function toggleHideChronicles(state)
    for _, tag in ipairs(tagsFolder:GetChildren()) do
        tag.Enabled = not state
    end
end

module[9] = {
    Type = "Toggle",
    Args = {"Hide Tags", function(Self)
        -- Toggle rainbow effect
        rainbowTags = not rainbowTags
        
        -- Toggle visibility of Chronicles tags
        hideChroniclesTags = not hideChroniclesTags
        
        toggleRainbowTags(rainbowTags)
        toggleHideChronicles(hideChroniclesTags)
    end}
}

-- Module 4: Information Text
module[10] = {
    Type = "Text",
    Args = {"Made By Brandon Jay | Tiktok: @brx12k"}
}

-- Initialize Modules as disabled
module[1].Enabled = false
module[3].Enabled = false
module[5].Enabled = false
module[6].Enabled = false
module[7].Enabled = false
module[8].Enabled = false

-- Add modules to global modules list
_G.Modules = _G.Modules or {}
table.insert(_G.Modules, module)

return module
